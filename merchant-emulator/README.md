# Merchant Emulator

Эмулятор мерчанта для тестирования системы лимитов платформы Chase.

## Установка

```bash
cd merchant-emulator
bun install
```

## Использование

### Базовый запуск

```bash
MERCHANT_TOKEN=your_merchant_token bun run index.ts
```

### Параметры конфигурации

Все параметры передаются через переменные окружения:

- `MERCHANT_TOKEN` (обязательный) - токен мерчанта для API
- `API_URL` - URL API сервера (по умолчанию: http://localhost:3001)
- `MIN_AMOUNT` - минимальная сумма транзакции в рублях (по умолчанию: 1000)
- `MAX_AMOUNT` - максимальная сумма транзакции в рублях (по умолчанию: 50000)
- `DELAY` - задержка между запросами в миллисекундах (по умолчанию: 1000)
- `TOTAL_REQUESTS` - общее количество запросов (если не указано - работает бесконечно)

### Примеры

1. Запуск с ограниченным количеством запросов:
```bash
MERCHANT_TOKEN=your_token TOTAL_REQUESTS=100 bun run index.ts
```

2. Запуск с кастомным диапазоном сумм:
```bash
MERCHANT_TOKEN=your_token MIN_AMOUNT=5000 MAX_AMOUNT=20000 bun run index.ts
```

3. Быстрый тест с малой задержкой:
```bash
MERCHANT_TOKEN=your_token DELAY=100 TOTAL_REQUESTS=50 bun run index.ts
```

## Функциональность

Эмулятор выполняет следующие действия:

1. Создает транзакции со случайными суммами в указанном диапазоне
2. Использует уникальные orderId для каждой транзакции
3. Отслеживает статистику успешных и неудачных запросов
4. Показывает распределение ошибок
5. Может работать в бесконечном режиме или с ограничением по количеству запросов

## Тестирование лимитов

Эмулятор позволяет проверить работу следующих лимитов:

1. **Лимит по количеству операций** - при достижении лимита операций на реквизите, эмулятор получит ошибку NO_REQUISITE
2. **Лимит по сумме** - при превышении общей суммы на реквизите
3. **Лимит активных транзакций** - при превышении количества одновременных транзакций
4. **Общие лимиты** - при исчерпании всех доступных реквизитов

## Статистика

Эмулятор показывает в реальном времени:
- Количество успешных и неудачных транзакций
- Процент успешности
- Распределение ошибок по типам

Для остановки используйте Ctrl+C - будет показана финальная статистика.